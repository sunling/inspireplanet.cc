<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>é‡‘å¥å¡ç‰‡ç¼–è¾‘å™¨</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link rel="stylesheet" href="card.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter&family=Playfair+Display&family=Montserrat&family=Lato&family=Dancing+Script&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC&family=Noto+Serif+SC&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">

  <style>
    * {
      -webkit-font-smoothing: antialiased;
    }

    body {
      display: flex;
      gap: 40px;
      padding: 40px;
      font-family: 'PingFang SC', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
    }

    .card-body {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .card-body p {
      flex-grow: 1;
      font-size: 14px;
      margin-bottom: 20px;
      min-height: 150px;
    }

    .form {
      width: 320px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .form input,
    .form textarea,
    .form select {
      width: 100%;
      padding: 8px;
      font-size: 14px;
    }

    .form label {
      font-weight: bold;
    }

    .buttons {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    button {
      padding: 8px 16px;
      background: #323449;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="form">
    <label>é€‰æ‹©å­—ä½“ï¼š
      <select id="choose-font" onchange="renderCard()">
        <option value="'LXGW WenKai', serif">éœé¹œæ–‡æ¥·</option>
        <option value="'Noto Sans SC', sans-serif">æ€æºé»‘ä½“</option>
        <option value="'Ma Shan Zheng', cursive">é©¬å–„æ”¿æ¯›ç¬”ä½“</option>
        <option value="'Alibaba PuHuiTi', sans-serif">é˜¿é‡Œæ±‰ä»ªæ™ºèƒ½é»‘ä½“</option>
        <option value="'Smiley Sans', sans-serif">å¾—æ„é»‘</option>
        <option value="'Noto Serif SC', serif">æ€æºå®‹ä½“</option>
        <option value="'PingFang SC', sans-serif">è‹¹æ–¹</option>
        <option value="'KaiTi', serif">æ¥·ä½“</option>
      </select>
    </label>
    <label>æ ‡é¢˜: 
      <input id="title" value="è¿™ä¸€åˆ»ï¼Œæˆ‘æƒ³è¯´..." oninput="renderCard()">
    </label>
    <label>å¬åˆ°çš„è§‚ç‚¹: 
      <small style="color: #888; font-size: 12px;">
        å°æç¤ºï¼šæ¥è‡ªä¹¦ç±ã€æ’­å®¢ã€ç”µå½±ã€å¯¹è¯ä¸­è®©ä½ çœ¼å‰ä¸€äº®çš„å¥å­éƒ½å¯ä»¥å†™ä¸‹æ¥ã€‚
      </small>
      <textarea id="quote" oninput="renderCard()">ğŸ“– ä¸€æœ¬ä¹¦é‡ŒæŸå¥è¯ã€ğŸ™ï¸æ’­å®¢é‡Œçš„ä¸€ä¸ªè§‚ç‚¹ã€ğŸ¬ç”µå½±é‡Œçš„ç‰‡æ®µâ€¦â€¦é‚£äº›çªç„¶è§¦åŠ¨ä½ çš„æ—¶åˆ»ï¼Œéƒ½å€¼å¾—è®°å½•ã€‚</textarea>
    </label>
    <label>é€‰æ‹©æ’å›¾:
      <select id="image-select" onchange="onSelectImage()"></select>
    </label>
    <label>ä¸Šä¼ è‡ªå®šä¹‰æ’å›¾:
      <input type="file" id="bgUpload" accept="image/*" />
    </label>
    <label>ä½ çš„å¯å‘:
      <textarea id="detail" oninput="renderCard()"
        style="min-height: 80px; resize: vertical;">è¢«ä»€ä¹ˆæ‰“åŠ¨ â†’ åšäº†ä»€ä¹ˆå°è¡ŒåŠ¨ â†’ æ„Ÿå—åˆ°ä»€ä¹ˆä¸åŒ</textarea>
    </label>
    <label>åˆ›ä½œè€…: <input id="creator" value="ä½ çš„åå­—" oninput="renderCard()"></label>

    <div class="buttons">
      <button onclick="renderCard()">é¢„è§ˆ</button>
      <button onclick="downloadCard()">ä¸‹è½½</button>
    </div>
  </div>
  <div id="preview" class="card">
    <!-- å¡ç‰‡å†…å®¹å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
  </div>

  <script>
    let customImage = "";
    function getDateFromEpisode(episodeNum) {
      const base = new Date('2025-04-12');
      const diff = episodeNum - 13;

      const currentDate = new Date(base.getTime() + diff * 7 * 24 * 60 * 60 * 1000);
      const nextDate = new Date(currentDate.getTime() + 7 * 24 * 60 * 60 * 1000);

      const fmt = (date) => {
        const m = date.getMonth() + 1;
        const d = date.getDate();
        return `${m}æœˆ${d}æ—¥`;
      };

      return {
        date: `${currentDate.getFullYear()}å¹´${currentDate.getMonth() + 1}æœˆ${currentDate.getDate()}æ—¥`,
        meeting: `${fmt(nextDate)}æ—©8:00`
      };
    }

    function loadImages() {
      fetch('images.json')
        .then(res => res.json())
        .then(images => {
          const select = document.getElementById('image-select');

          // æ¸…ç©ºç°æœ‰é€‰é¡¹
          select.innerHTML = '';

          // æ·»åŠ æ–°é€‰é¡¹
          images.forEach(img => {
            const option = new Option(img, `images/${img}`);
            select.add(option);
          });

          // åˆå§‹åŒ–æ¸²æŸ“
          renderCard();
        })
        .catch(e => {
          console.error('åŠ è½½èƒŒæ™¯å›¾å¤±è´¥:', e);
          // è®¾ç½®é»˜è®¤èƒŒæ™¯
          document.getElementById('image-select').innerHTML = `
                <option value="images/biking.png">é»˜è®¤èƒŒæ™¯</option>
              `;
        });
    }

    function onSelectImage() {
      customImage = "";
      renderCard();
    }

    function renderCard() {
      const title = document.getElementById('title').value;
      const quote = document.getElementById('quote').value;
      const detail = document.getElementById('detail').value;
      const imagePath = document.getElementById('image-select').value;
      const creator = document.getElementById('creator').value || "è¯·åŠ ä¸Šä½ çš„åå­—";
      const selectedFont = document.getElementById('choose-font').value;
      //é‡‘å¥æ’å›¾
      const finalImage = customImage || imagePath;
      const todaydate = getCurrentDate();

      document.getElementById('preview').innerHTML = `
        <div class="card" style="font-family: ${selectedFont}">
             <div class="card-body">
              <div class="title">${title}</div>
              <div class="quote-box">${quote}</div>
              <img id="quote-image" src="${finalImage}" alt="é‡‘å¥æ’å›¾" />
              <p>${detail}</p>
            </div>
            <div class="card-footer">
                <div class="footer">â€”â€”ä½œè€…ï¼š${creator} - ${todaydate}</div>
            </div>
        </div>`;
      //<div class="meeting">æ¬¢è¿ä½ å‚åŠ æ¯å‘¨å…­æ—©8ç‚¹çš„å¯å‘æ˜Ÿçƒçº¿ä¸Šè…¾è®¯ä¼šè®®: <span class="highlight">818 7279 2687</span></div>

    }

    function getCurrentDate() {
      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, '0'); // æœˆä»½ä»0å¼€å§‹
      const dd = String(now.getDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
    }

    function downloadCard() {
      // ç¡®ä¿æ•è·çš„æ˜¯æ¸²æŸ“å®Œæˆçš„å°é¢
      const cardElement = document.getElementById('preview');

      // æ·»åŠ å»¶æ—¶ç¡®ä¿æ¸²æŸ“å®Œæˆ
      setTimeout(() => {
        html2canvas(cardElement, {
          scale: 2, // æé«˜å¯¼å‡ºè´¨é‡
          logging: true,
          useCORS: true, // å…è®¸è·¨åŸŸå›¾ç‰‡
          backgroundColor: '#2f2f46'
        }).then(canvas => {
          const link = document.createElement('a');
          link.download = 'inspiration-card-' + new Date().getTime() + '.png';
          link.href = canvas.toDataURL('image/png');
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        });
      }, 500);
    }

    window.onload = function () {
      loadImages();
      renderCard();
      // upload image
      document.getElementById("bgUpload").addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function (e) {
          customImage = e.target.result;
          renderCard();
        };
        reader.readAsDataURL(file);
      });
    };
  </script>
</body>

</html>