<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>å¯å‘æ—¶åˆ»å¡ç‰‡ç¼–è¾‘å™¨</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="utils.js"></script>
  <link rel="stylesheet" href="common.css" />
  <link rel="stylesheet" href="card.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter&family=Playfair+Display&family=Montserrat&family=Lato&family=Dancing+Script&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC&family=Noto+Serif+SC&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">

  <style>
    * {
      -webkit-font-smoothing: antialiased;
    }

    body {
      display: flex;
      gap: 40px;
      padding: 40px;
      font-family: 'PingFang SC', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
    }

    .card-body {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .card-body p {
      flex-grow: 1;
      font-size: 15px;
      margin-bottom: 20px;
      min-height: 130px;
    }

    .form {
      width: 400px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .form input,
    .form textarea,
    .form select {
      width: 100%;
      padding: 8px;
      font-size: 14px;
    }

    .form label {
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="form">
    <label>é€‰æ‹©ä¸»é¢˜é…è‰²ï¼š
      <select id="theme-select" onchange="renderCard()">
        <option value="morning">æ™¨å…‰ç±³æ</option>
        <option value="creamMatcha">å¥¶æ²¹æŠ¹èŒ¶</option>
        <option value="lavenderMist">äº‘é›¾ç´«ç°</option>
        <option value="darkblue">æ·±è“ç»å…¸</option>
        <option value="green">æ·±ç»¿ç±³ç™½</option>
        <option value="brown">æ·±æ£•æ¸©æš–</option>
        <option value="purple">æ·±ç´«æŸ”ç²‰</option>
        <option value="grayblue">ç°è“æç®€</option>
        <option value="mistyblue">æµ…é›¾è“ç°</option>
        <option value="roseclay">è±†æ²™ç«ç‘°</option>
      </select>
    </label>

    <label>é€‰æ‹©å­—ä½“ï¼š
      <select id="choose-font" onchange="renderCard()">
        <option value="'Noto Sans SC', sans-serif">æ€æºé»‘ä½“</option>
        <option value="'Smiley Sans', sans-serif">å¾—æ„é»‘</option>
        <option value="'Ma Shan Zheng', cursive">é©¬å–„æ”¿æ¯›ç¬”ä½“</option>
        <option value="'LXGW WenKai', serif">éœé¹œæ–‡æ¥·</option>
        <option value="'Alibaba PuHuiTi', sans-serif">é˜¿é‡Œæ±‰ä»ªæ™ºèƒ½é»‘ä½“</option>
        <option value="'Noto Serif SC', serif">æ€æºå®‹ä½“</option>
        <option value="'PingFang SC', sans-serif">è‹¹æ–¹</option>
        <option value="'KaiTi', serif">æ¥·ä½“</option>
      </select>
    </label>
    <label>æ ‡é¢˜:
      <input id="title" placeholder="è¿™ä¸€åˆ»ï¼Œæˆ‘æƒ³è¯´..." oninput="renderCard()">
    </label>
    <label>è§¦åŠ¨ä½ çš„è§‚ç‚¹:
      <small style="color: #888; font-size: 9px;">
        æ¥è‡ªä¹¦ç±ã€æ’­å®¢ã€ç”µå½±ã€å¯¹è¯ä¸­è®©ä½ çœ¼å‰ä¸€äº®çš„å¥å­éƒ½å¯ä»¥å†™ä¸‹æ¥å“¦
      </small>
      <textarea id="quote" oninput="renderCard()" placeholder="ä¸€æœ¬ä¹¦é‡ŒæŸå¥è¯/æ’­å®¢é‡Œçš„ä¸€ä¸ªè§‚ç‚¹/ç”µå½±é‡Œçš„ç‰‡æ®µâ€¦â€¦é‚£äº›çªç„¶è§¦åŠ¨ä½ çš„æ—¶åˆ»ï¼Œéƒ½å€¼å¾—è®°å½•ã€‚"></textarea>
    </label>
    <label>é€‰æ‹©æ’å›¾:
      <select id="image-select" onchange="onSelectImage()"></select>
    </label>
    <label>è‡ªå®šä¹‰æ’å›¾:
      <div class="file-upload-wrapper">
        <button type="button" id="uploadBtn" class="upload-btn">ä¸Šä¼ å›¾ç‰‡</button>
        <span id="fileStatus" style="color: #888; font-size: 12px;">No file chosen</span>
        <input type="file" id="bgUpload" accept="image/*" style="display: none;">
      </div>
    </label>
    <label>ä½ çš„å¯å‘(æŒ‰å›è½¦æ¢è¡Œ):
      <small style="color: #888; font-size: 9px;">è®°å½•ä¸‹â€˜è¯´åˆ°ä½ å¿ƒé‡Œå»äº†â€™çš„é‚£ä¸€åˆ»å§</small>
      <textarea id="detail" oninput="renderCard()" style="min-height: 80px; resize: vertical;"
        placeholder="å¬å®Œ/è¯»å®Œä¹‹åï¼Œæˆ‘åš/æ€è€ƒäº†..."></textarea>
    </label>
    <label>åˆ›ä½œè€…: <input id="creator" placeholder="ä½ çš„åå­—" oninput="renderCard()"></label>

    <div class="buttons">
      <button onclick="submitCard()">ğŸ“© æäº¤å¹¶åŠ å…¥å±•ç¤ºé˜Ÿåˆ—</button>
      ğŸ‘‰ <a style="font-size: 11px; color: #666; margin-top: 8px;"
        href="https://sunling.github.io/content-crafter-kit/generated/inspiration-cards/inspirations.html"
        target="_blank">
        æŸ¥çœ‹å¯å‘å¡ç‰‡å±•ç¤ºåŒº
      </a>
      <button onclick="saveCard('preview', 'inspiration-card-')">ä¸‹è½½</button>
    </div>
    <p style="font-size: 13px; color: #666; margin-top: 8px;">
      ğŸ“Œ æäº¤åï¼Œå¡ç‰‡å†…å®¹å°†è¿›å…¥å±•ç¤ºå€™é€‰åŒºï¼Œç”±ç¼–è¾‘å®¡æ ¸åç”Ÿæˆå›¾ç‰‡å¹¶å…¬å¼€å±•ç¤ºã€‚
      <br />
      ä¸Šä¼ çš„è‡ªå®šä¹‰æ’å›¾ä¸ä¼šè¢«è®°å½•ï¼Œæœ€ç»ˆå±•ç¤ºå°†ä½¿ç”¨ä¸€å¼ å†…ç½®èƒŒæ™¯å›¾è¿›è¡Œç¾åŒ–ã€‚
    </p>

  </div>
  <div id="preview">
    <!-- å¡ç‰‡å†…å®¹å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
  </div>

  <script>
    let customImage = "";

    function onSelectImage() {
      customImage = "";
      document.getElementById("fileStatus").innerHTML = "";
      renderCard();
    }

    function submitCard() {
      uploadCardToAirtable({
        theme: themes[document.getElementById('theme-select').value],
        font: document.getElementById("choose-font").value,
        title: document.getElementById('title').value,
        quote: document.getElementById('quote').value,
        imagePath: document.getElementById('image-select').value,
        detail: document.getElementById('detail').value,
        creator: document.getElementById('creator').value,
        upload: document.getElementById('fileStatus').innerText
      });
    }

    function renderCard(customInsertImage) {
      // å¦‚æœå‚æ•°customInsertImageæœ‰å€¼ï¼Œé‚£ä¹ˆæ›´æ–°
      if (customInsertImage) {
        customImage = customInsertImage;
      }

      const title = document.getElementById('title').value || "è¿™ä¸€åˆ»ï¼Œæˆ‘æƒ³è¯´...";
      const quoteRaw = document.getElementById('quote').value || "ã€ŠåŸåˆ™ã€‹ï¼šäººé¿å…ä¸äº†ç—›è‹¦ï¼Œå°¤å…¶æ˜¯åœ¨è¿½æ±‚é›„å¿ƒå‹ƒå‹ƒçš„ç›®æ ‡æ—¶ã€‚ä¿¡ä¸ä¿¡ç”±ä½ ï¼Œå¦‚æœä»¥æ­£ç¡®çš„æ€åº¦å¯¹å¾…ç—›è‹¦ï¼Œæ„Ÿåˆ°ç—›è‹¦å°±æ˜¯ä½ çš„å¹¸è¿ï¼Œå› ä¸ºè¿™å°†æç¤ºä½ å¯»æ‰¾è§£å†³æ–¹æ¡ˆä»¥ä¾¿ç»§ç»­å‰è¿›ã€‚";
      const quote = quoteRaw.replace(/\n/g, '<br>');
      const detailRaw = document.getElementById('detail').value || "ä½ æ€ä¹ˆçœ‹å‘¢ï¼Ÿ";
      const detail = detailRaw.replace(/\n/g, '<br>');

      const imagePath = document.getElementById('image-select').value;
      const creator = document.getElementById('creator').value || "ä½ çš„åå­—";
      const selectedFont = document.getElementById('choose-font').value;
      //é‡‘å¥æ’å›¾
      const finalImage = customImage || imagePath;
      //ä¸»é¢˜è®¾ç½®
      const theme = document.getElementById("theme-select").value;
      const selectedTheme = themes[theme];

      const nowObj = new Date();
      const formatted = `${nowObj.getFullYear()}å¹´${nowObj.getMonth() + 1}æœˆ${nowObj.getDate()}æ—¥ ${nowObj.getHours()}:${String(nowObj.getMinutes()).padStart(2, '0')}`;

      document.getElementById('preview').innerHTML = `
        <div class="card" style="
              font-family: ${selectedFont};
              background-color: ${selectedTheme.background};
              color: ${selectedTheme.color};
            ">
             <div class="card-body">
              <div class="title">${title}</div>
              <div class="quote-box" style="
                background-color: ${selectedTheme.quoteBg}; 
                color: ${selectedTheme.quoteColor};
              ">${quote}</div>
              <img id="quote-image" src="${finalImage}" alt="é‡‘å¥æ’å›¾" />
              <p id="detail-text">${detail}</p>
            </div>
            <div class="card-footer">
                <div class="footer" style="color: ${selectedTheme.color}">â€”â€”ä½œè€…ï¼š${creator} Â· ${formatted}</div>
            </div>
        </div>`;
      document.getElementById('detail-text').innerHTML = detail;
      //<div class="meeting">æ¬¢è¿ä½ å‚åŠ æ¯å‘¨å…­æ—©8ç‚¹çš„å¯å‘æ˜Ÿçƒçº¿ä¸Šè…¾è®¯ä¼šè®®: <span class="highlight">818 7279 2687</span></div>
    }

    function isMobileDevice() {
      return (
        /Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
        window.innerWidth < 768
      );
    }

    function saveCard(previewId, prefix) {
      if (isMobileDevice()) {
        downloadCardToImageView(previewId, prefix);
      } else {
        download(previewId, prefix);
      }

    }

    function saveDraft() {
      const card = {
        title: document.getElementById("title").value,
        quote: document.getElementById("quote").value,
        detail: document.getElementById("detail").value,
        creator: document.getElementById("creator").value,
        image: document.getElementById("image-select").value,
        font: document.getElementById("choose-font").value,
        theme: document.getElementById("theme-select").value
      };
      localStorage.setItem("draftCard", JSON.stringify(card));
    }

    function loadDraft() {
      const card = JSON.parse(localStorage.getItem("draftCard") || "null");
      if (!card) return;

      document.getElementById("title").value = card.title;
      document.getElementById("quote").value = card.quote;
      document.getElementById("detail").value = card.detail;
      document.getElementById("creator").value = card.creator;
      document.getElementById("choose-font").value = card.font;
      document.getElementById("theme-select").value = card.theme;

      // åŠ è½½ä¸Šæ¬¡é€‰å¥½çš„å†…ç½®å›¾
      setTimeout(() => {
        const select = document.getElementById("image-select");
        const options = select.options;
        for (let i = 0; i < options.length; i++) {
          if (options[i].value === card.image) {
            select.selectedIndex = i;
            break;
          }
        }
        renderCard(card.image);
      }, 50);
    }

    function autoSaveDraft() {
      const fields = ["title", "quote", "detail", "creator", "image-select", "choose-font", "theme-select"];
      fields.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener("input", () => saveDraft());
      });
    }

    window.addEventListener("DOMContentLoaded", () => {
      loadDraft();
      autoSaveDraft();
    });

    window.onload = function () {
      renderCard();
      loadImages(() => {
        loadDraft();
        renderCard();
      });
      bindCustomFileUpload({
        inputId: "bgUpload",
        buttonId: "uploadBtn",
        statusId: "fileStatus",
        onLoad: renderCard
      });
    };
  </script>
</body>

</html>