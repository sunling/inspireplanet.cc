<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åˆ›é€ ä½ çš„å¯å‘æ—¶åˆ»å¡ç‰‡</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://unpkg.com/dompurify@3.0.6/dist/purify.min.js"></script>
  <!-- Add Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Import the new combined utility file as a module -->
  <script type="module" src="scripts/cardUtils.js"></script>
  <script type="module">
    import { initShareFunction } from './scripts/shareUtils.js';

    // åˆå§‹åŒ–åˆ†äº«åŠŸèƒ½
    document.addEventListener('DOMContentLoaded', function () {
      initShareFunction({
        cardSelector: '.card',
        shareButtonSelector: 'button[onclick="shareToWechat()"]',
        getShareData: function () {
          // è·å–å¡ç‰‡ä¿¡æ¯
          const title = document.getElementById('title').value || 'æˆ‘çš„å¯å‘æ—¶åˆ»å¡ç‰‡';
          const quote = document.getElementById('quote').value || 'åˆ†äº«ä¸€ä¸ªè§¦åŠ¨æˆ‘çš„è§‚ç‚¹';
          const creator = document.getElementById('creator').value || 'åŒ¿å';

          return {
            title: `${title} - by ${creator}`,
            desc: quote.length > 50 ? quote.substring(0, 50) + '...' : quote,
            link: window.location.href
          };
        }
      });
    });
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter&family=Playfair+Display&family=Montserrat&family=Lato&family=Dancing+Script&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC&family=Noto+Serif+SC&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">

  <style>
    * {
      -webkit-font-smoothing: antialiased;
      box-sizing: border-box;
    }

    body {
      display: flex;
      flex-direction: column;
      margin: 0;
      padding: 0;
      font-family: 'PingFang SC', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, #f9f9f9, #e0eafc);
      min-height: 100vh;
      color: #333;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #FFB6C1, #FFE4E1, #F0E68C, #E0FFFF, #DDA0DD);
      color: #333;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
      padding-top: 22px;
      text-align: left;
      margin-bottom: -8px;
    }

    .header::before {
      content: '';
      position: absolute;
      inset: 0;
      background: url('images/mistyblue.png') center/cover no-repeat;
      opacity: 0.1;
      z-index: 0;
    }

    .header h1 {
      font-size: 32px;
      margin-bottom: 15px;
      font-weight: bold;
      animation: fadeInDown 1s ease;
    }

    .header p {
      font-size: 18px;
      line-height: 1.6;
      margin: 0 auto;
      animation: fadeIn 1.5s ease;
    }

    /* Container */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
      gap: 40px;
      align-items: flex-start;
    }

    .main-content {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      padding: 30px;
      margin-bottom: 40px;
      position: relative;
      overflow: hidden;
      align-items: flex-start;
    }

    /* Form */
    .form {
      width: 600px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-self: flex-start;
      position: sticky;
      top: 0;
    }

    .form-row {
      display: flex;
      gap: 15px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
    }

    .form label {
      font-weight: bold;
      color: #4a6fa5;
      font-size: 14px;
    }

    /* é‡è¦å­—æ®µçš„æ ‡ç­¾æ ·å¼ */
    label[for="title"],
    label[for="quote"],
    label[for="detail"],
    label[for="creator"],
    label[for="title"] {
      font-size: 15px !important;
      font-weight: 700 !important;
      color: #2c3e50 !important;
      margin-bottom: 8px !important;
    }

    /* æ·»åŠ å¿…å¡«æ ‡è¯† */
    label[for="title"]::after,
    label[for="quote"]::after,
    label[for="detail"]::after {
      content: " *";
      color: #e74c3c;
      font-weight: bold;
    }

    .form input,
    .form textarea,
    .form select {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f9f9f9;
      transition: all 0.3s ease;
    }

    /* é‡è¦è¾“å…¥æ¡†æ ·å¼ - æ ‡é¢˜ã€è§‚ç‚¹ã€å¯å‘ã€ä½œè€… */
    #title,
    #quote,
    #detail,
    #creator {
      background-color: #fff;
      border: 1.5px solid #ddd;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
      font-weight: 500;
      transition: all 0.3s ease;
    }

    #title {
      font-size: 16px;
      padding: 12px;
      /* border-color: #FFB6C1; */
      box-shadow: 0 1px 4px rgba(255, 182, 193, 0.1);
    }

    #quote,
    #detail {
      font-size: 15px;
      padding: 12px;
      line-height: 1.5;
      border-color: #B0C4DE;
      box-shadow: 0 1px 4px rgba(176, 196, 222, 0.1);
    }

    #creator {
      border-color: #B0C4DE;
      box-shadow: 0 1px 4px rgba(176, 196, 222, 0.1);
    }

    .form input:focus,
    .form textarea:focus,
    .form select:focus {
      border-color: #4a6fa5;
      box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
      background-color: #fff;
      outline: none;
    }

    #title:focus,
    #quote:focus,
    #detail:focus,
    #creator:focus {
      border-color: #4a6fa5 !important;
      box-shadow: 0 0 0 4px rgba(74, 111, 165, 0.3) !important;
    }

    /* Preview */
    #preview {
      width: 460px;
      display: flex;
      justify-content: center;
      /* Center card horizontally */
      align-items: flex-start;
      /* Center card vertically */
      padding: 24px;
      border-radius: 16px;
      background: transparent;
      transition: all 0.3s ease;
    }

    /* Card styles moved to card-common.css */

    /* Buttons */
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 20px;
      align-items: center;
    }

    button {
      padding: 12px 20px;
      /* background: linear-gradient(135deg, #FFE4E1, #F0E68C, #E0FFFF); */
      color: #666;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(255, 182, 193, 0.3);
    }

    button:hover {
      background: linear-gradient(135deg, #FFD1DC, #F5DEB3, #B0E0E6);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 182, 193, 0.4);
    }

    .primary-btn {
      background: linear-gradient(135deg, #FF91A4, #FFB6C1, #FFE4B5, #98FB98) !important;
      color: #fff !important;
      /* font-size: 16px; */
      /* padding: 14px 24px; */
      font-weight: 700;
      box-shadow: 0 6px 20px rgba(255, 145, 164, 0.4);
      /* border: 2px solid rgba(255, 255, 255, 0.3); */
      position: relative;
      overflow: hidden;
    }

    .primary-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }

    .primary-btn:hover::before {
      left: 100%;
    }

    .primary-btn:hover {
      background: linear-gradient(135deg, #FF69B4, #FF91A4, #FFD700, #90EE90) !important;
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 25px rgba(255, 105, 180, 0.5);
    }

    .upload-btn {
      background: linear-gradient(135deg, #F5F5F5, #E6E6FA, #F0F8FF);
      color: #666;
      border: 1px solid rgba(221, 160, 221, 0.3);
      box-shadow: 0 3px 8px rgba(221, 160, 221, 0.2);
      min-width: 140px;
      padding: 8px 16px;
    }

    .upload-btn:hover {
      background: linear-gradient(135deg, #E6E6FA, #D8BFD8, #E0E6FF);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(221, 160, 221, 0.3);
    }

    /* Carousel */
    .latest-cards-section {
      margin-top: 40px;
      width: 100%;
    }

    .carousel-container {
      width: 100%;
      max-width: 1200px;
      /* margin: 0 auto; */
      /* padding: 20px 0; */
    }

    .swiper {
      width: 100%;
      padding-bottom: 40px;
    }

    .swiper-slide {
      display: flex;
      justify-content: center;
      align-items: center;
      /* padding: 10px; */
    }

    .carousel-card-wrapper {
      width: 100%;
      max-width: 420px;
      /* min-width: 300px; */
      box-sizing: border-box;
    }

    .swiper-pagination {
      bottom: 0;
    }

    .swiper-button-next,
    .swiper-button-prev {
      color: #4a6fa5;
    }

    .view-all-button-container {
      text-align: center;
      margin-top: 20px;
    }

    .view-all-button {
      display: inline-block;
      background-color: #FF7F50;
      /* æ©™è‰²ï¼Œå’Œæäº¤æŒ‰é’®ç»Ÿä¸€ */
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 16px;
      text-decoration: none;
      transition: transform 0.2s, background-color 0.2s;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .view-all-button:hover {
      background-color: #ff9966;
      /* hoveræ—¶æ›´äº®ä¸€ç‚¹ */
      transform: scale(1.05);
    }


    /* ç»Ÿä¸€æŒ‰é’®åŸºç¡€æ ·å¼ */
    .header-btn {
      display: inline-block;
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 600;
      border-radius: 8px;
      text-decoration: none;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
      color: #666;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.5);
      cursor: pointer;
      backdrop-filter: blur(10px);
      text-align: center;
      white-space: nowrap;
    }

    .header-btn:hover {
      background: rgba(255, 255, 255, 1);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      color: #444;
    }

    /* View all button - ç»§æ‰¿ç»Ÿä¸€æ ·å¼ */
    .view-all-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      margin: 0;
      z-index: 10;
    }

    /* Footer */
    .page-footer {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      margin-top: auto;
      color: #666;
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes shimmer {
      0% {
        background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
      }

      100% {
        background-position: 20px 20px, 20px 30px, 30px 10px, 10px 20px;
      }
    }

    /* è®¤è¯ç›¸å…³æ ·å¼ */
    .auth-section {
      position: absolute;
      top: 15px;
      right: 450px;
      z-index: 20;
    }

    .login-buttons {
      display: flex;
      gap: 10px;
    }

    .auth-btn {
      /* ç§»é™¤åŸæœ‰æ ·å¼ï¼Œç»§æ‰¿ç»Ÿä¸€æ ·å¼ */
    }

    /* æ³¨å†ŒæŒ‰é’®ç‰¹æ®Šæ ·å¼ */
    .auth-btn.register-btn {
      background: linear-gradient(135deg, #28a745, #20c997) !important;
      color: white !important;
      border: 1px solid rgba(40, 167, 69, 0.3) !important;
    }

    .auth-btn.register-btn:hover {
      background: linear-gradient(135deg, #218838, #1ea085) !important;
      color: white !important;
    }

    /* ç‰¹æ®ŠæŒ‰é’®æ ·å¼ */
    .view-all-btn[style*="background-color: #e64a19"] {
      background: linear-gradient(135deg, #e64a19, #ff5722) !important;
      color: white !important;
      border: 1px solid rgba(230, 74, 25, 0.3) !important;
    }

    .view-all-btn[style*="background-color: #e64a19"]:hover {
      background: linear-gradient(135deg, #d84315, #e64a19) !important;
      color: white !important;
    }

    .user-profile {
      position: relative;
    }

    .user-avatar-container {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(10px);
    }

    .user-avatar-container:hover {
      background: rgba(255, 255, 255, 1);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .user-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.8);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .user-name {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      max-width: 100px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 8px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      padding: 8px 0;
      min-width: 140px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 100;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .user-avatar-container:hover .user-dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      width: 100%;
      padding: 10px 16px;
      border: none;
      background: none;
      text-align: left;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #666;
      transition: all 0.2s ease;
    }

    .dropdown-item:hover {
      background: rgba(102, 102, 102, 0.1);
      color: #444;
    }

    /* èƒŒæ™¯é€‰æ‹©å™¨æ ·å¼ */
    .gradient-selector {
      display: grid;
      grid-template-columns: repeat(14, 1fr);
      gap: 6px;
      margin-top: 6px;
    }

    .gradient-option {
      width: 38px;
      height: 38px;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .gradient-option:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .gradient-option.selected {
      border-color: #4a6fa5;
      box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.3);
      transform: scale(1.05);
    }

    .gradient-option::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: inherit;
      opacity: 0.8;
    }

    /* ä¸ºæ¯ä¸ªæ¸å˜é€‰é¡¹æ·»åŠ å¯¹åº”çš„èƒŒæ™¯ */
    .gradient-option[data-gradient="card-gradient-1"] {
      background-image: linear-gradient(to right top,
          rgba(209, 107, 165, 0.8), rgba(199, 119, 185, 0.7), rgba(186, 131, 202, 0.6),
          rgba(170, 143, 216, 0.5), rgba(154, 154, 225, 0.4), rgba(138, 167, 236, 0.3),
          rgba(121, 179, 244, 0.2), rgba(105, 191, 248, 0.3), rgba(82, 207, 254, 0.4),
          rgba(65, 223, 255, 0.5), rgba(70, 238, 250, 0.6), rgba(95, 251, 241, 0.7));
    }

    .gradient-option[data-gradient="card-gradient-2"] {
      background-image: linear-gradient(to right top,
          rgba(255, 126, 95, 0.8), rgba(255, 140, 109, 0.7), rgba(255, 154, 124, 0.6),
          rgba(255, 168, 138, 0.5), rgba(255, 182, 153, 0.4), rgba(255, 194, 168, 0.3),
          rgba(255, 206, 184, 0.2), rgba(255, 217, 199, 0.3), rgba(255, 229, 215, 0.4),
          rgba(255, 242, 231, 0.5), rgba(255, 254, 250, 0.6), rgba(255, 255, 255, 0.7));
    }

    .gradient-option[data-gradient="card-gradient-3"] {
      background-image: linear-gradient(to right top,
          rgba(107, 33, 168, 0.8), rgba(134, 47, 178, 0.7), rgba(160, 61, 189, 0.6),
          rgba(186, 76, 200, 0.5), rgba(211, 91, 211, 0.4), rgba(227, 108, 217, 0.3),
          rgba(242, 125, 223, 0.2), rgba(255, 141, 229, 0.3), rgba(255, 157, 226, 0.4),
          rgba(255, 172, 223, 0.5), rgba(255, 188, 221, 0.6), rgba(255, 204, 220, 0.7));
    }

    .gradient-option[data-gradient="card-gradient-4"] {
      background-image: linear-gradient(to right top,
          rgba(0, 201, 255, 0.8), rgba(0, 179, 255, 0.7), rgba(0, 156, 255, 0.6),
          rgba(0, 130, 255, 0.5), rgba(0, 100, 255, 0.4), rgba(0, 89, 255, 0.3),
          rgba(0, 77, 255, 0.2), rgba(0, 63, 255, 0.3), rgba(0, 49, 255, 0.4),
          rgba(0, 32, 255, 0.5), rgba(0, 12, 255, 0.6), rgba(11, 0, 255, 0.7));
    }

    .gradient-option[data-gradient="card-gradient-5"] {
      background-image: linear-gradient(to right top,
          rgba(249, 197, 44, 0.8), rgba(246, 182, 47, 0.7), rgba(242, 168, 51, 0.6),
          rgba(238, 153, 55, 0.5), rgba(233, 139, 60, 0.4), rgba(227, 126, 65, 0.3),
          rgba(221, 113, 70, 0.2), rgba(215, 100, 76, 0.3), rgba(207, 86, 79, 0.4),
          rgba(198, 73, 82, 0.5), rgba(188, 60, 84, 0.6), rgba(178, 48, 86, 0.7));
    }

    .gradient-option[data-gradient="card-gradient-6"] {
      background-image: linear-gradient(to right top,
          rgba(168, 255, 120, 0.8), rgba(159, 245, 120, 0.7), rgba(150, 235, 120, 0.6),
          rgba(141, 225, 120, 0.5), rgba(132, 215, 120, 0.4), rgba(124, 208, 120, 0.3),
          rgba(116, 201, 120, 0.2), rgba(108, 194, 120, 0.3), rgba(99, 186, 121, 0.4),
          rgba(90, 179, 121, 0.5), rgba(81, 172, 122, 0.6), rgba(72, 165, 122, 0.7));
    }

    .gradient-option[data-gradient="card-gradient-7"] {
      background-image: linear-gradient(to right top,
          rgba(255, 138, 0, 0.8), rgba(255, 122, 26, 0.7), rgba(255, 105, 42, 0.6),
          rgba(255, 86, 55, 0.5), rgba(255, 63, 67, 0.4), rgba(255, 54, 76, 0.3),
          rgba(255, 44, 85, 0.2), rgba(255, 33, 94, 0.3), rgba(255, 26, 106, 0.4),
          rgba(255, 23, 118, 0.5), rgba(255, 26, 131, 0.6), rgba(249, 37, 144, 0.7));
    }

    .gradient-option[data-gradient="card-gradient-8"] {
      background-image: linear-gradient(to right top,
          rgba(240, 248, 255, 0.8), rgba(230, 240, 250, 0.7), rgba(220, 235, 245, 0.6),
          rgba(210, 230, 240, 0.5), rgba(200, 225, 235, 0.4), rgba(190, 220, 230, 0.3),
          rgba(180, 215, 225, 0.2), rgba(170, 210, 220, 0.3));
    }

    .gradient-option[data-gradient="card-gradient-9"] {
      background-image: linear-gradient(to right top,
          rgba(248, 250, 252, 0.8), rgba(241, 245, 249, 0.7), rgba(234, 240, 246, 0.6),
          rgba(226, 232, 240, 0.5), rgba(203, 213, 225, 0.4), rgba(186, 200, 214, 0.3),
          rgba(169, 187, 203, 0.2), rgba(148, 163, 184, 0.3));
    }

    .gradient-option[data-gradient="card-gradient-10"] {
      background-image: linear-gradient(to right top,
          rgba(254, 252, 232, 0.8), rgba(253, 246, 178, 0.7), rgba(252, 211, 77, 0.6),
          rgba(245, 158, 11, 0.5), rgba(217, 119, 6, 0.4), rgba(180, 83, 9, 0.3),
          rgba(146, 64, 14, 0.2), rgba(120, 53, 15, 0.3));
    }

    .gradient-option[data-gradient="card-gradient-11"] {
      background-image: linear-gradient(to right top,
          rgba(240, 253, 244, 0.8), rgba(220, 252, 231, 0.7), rgba(187, 247, 208, 0.6),
          rgba(134, 239, 172, 0.5), rgba(74, 222, 128, 0.4), rgba(34, 197, 94, 0.3),
          rgba(22, 163, 74, 0.2), rgba(21, 128, 61, 0.3));
    }

    .gradient-option[data-gradient="card-gradient-12"] {
      background-image: linear-gradient(to right top,
          rgba(253, 244, 255, 0.8), rgba(250, 232, 255, 0.7), rgba(243, 232, 255, 0.6),
          rgba(233, 213, 255, 0.5), rgba(196, 181, 253, 0.4), rgba(167, 139, 250, 0.3),
          rgba(139, 92, 246, 0.2), rgba(124, 58, 237, 0.3));
    }

    .gradient-option[data-gradient="card-gradient-13"] {
      background-image: linear-gradient(to right top,
          rgba(255, 251, 235, 0.8), rgba(254, 243, 199, 0.7), rgba(253, 230, 138, 0.6),
          rgba(252, 211, 77, 0.5), rgba(245, 158, 11, 0.4), rgba(217, 119, 6, 0.3),
          rgba(194, 65, 12, 0.2), rgba(154, 52, 18, 0.3));
    }

    .gradient-option[data-gradient="card-gradient-14"] {
      background-image: linear-gradient(to right top,
          rgba(248, 250, 252, 0.8), rgba(241, 245, 249, 0.7), rgba(226, 232, 240, 0.6),
          rgba(203, 213, 225, 0.5), rgba(148, 163, 184, 0.4), rgba(100, 116, 139, 0.3),
          rgba(71, 85, 105, 0.2), rgba(51, 65, 85, 0.3));
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
        padding: 20px;
      }

      .form,
      #preview {
        width: 100%;
      }

      .carousel-card-wrapper {
        max-width: 90%;
      }

      .auth-section {
        position: static;
        margin-bottom: 10px;
        right: auto;
        display: flex;
        justify-content: center;
      }

      .login-buttons {
        justify-content: center;
      }

      .user-avatar-container {
        justify-content: center;
      }

      .gradient-selector {
        grid-template-columns: repeat(7, 1fr);
      }

      .gradient-option {
        width: 35px;
        height: 35px;
      }
    }

    /* Markdown styles moved to card-common.css */
  </style>
  <link rel="stylesheet" href="/styles/card-common.css">
  <link rel="stylesheet" href="/styles/card-gradients.css">

</head>

<body>
  <!-- Header Section -->
  <header class="header">
    <div class="container">
      <h1>åˆ›é€ ä½ çš„å¯å‘æ—¶åˆ»å¡ç‰‡</h1>
      <p>ğŸ’¬ å˜¿ï¼Œä»Šå¤©å“ªä¸ªç¬é—´æˆ³ä¸­äº†ä½ ï¼Ÿâœ¨ å¿«è®°ä¸‹æ¥ï¼è¿™äº›ç¢ç‰‡ä¼šåœ¨æœªæ¥å‘èŠ½ğŸŒ±</p>
      <p>â–¸ ä¹¦é‡ŒæŸå¥è®©ä½ çŒ›åˆ’çº¿çš„è¯ï¼Ÿâ–¸ æ’­å®¢é‡Œé‚£ä¸ªè®©ä½ çªç„¶æŒ‰ä¸‹æš‚åœé”®çš„è§‚ç‚¹ï¼Ÿâ–¸ ç”µå½±é‡Œä¹…ä¹…å¿˜ä¸æ‰çš„é•œå¤´ï¼Ÿ</p>
    </div>
    <div>
      <!-- ç”¨æˆ·è®¤è¯åŒºåŸŸ -->
      <div id="auth-section" class="auth-section">
        <!-- æœªç™»å½•çŠ¶æ€ -->
        <div id="login-buttons" class="login-buttons">
          <a href="https://bysunling.com/auth?redirect=https://cards.bysunling.com" class="header-btn auth-btn">ç™»å½•</a>
          <!-- <a href="https://bysunling.com/auth?tab=register&redirect=https://cards.bysunling.com" class="header-btn auth-btn register-btn">æ³¨å†Œ</a> -->
        </div>

        <!-- å·²ç™»å½•çŠ¶æ€ -->
        <div id="user-profile" class="user-profile" style="display: none;">
          <div class="user-avatar-container">
            <img id="user-avatar" class="user-avatar" src="" alt="ç”¨æˆ·å¤´åƒ" crossorigin="anonymous">
            <span id="user-name" class="user-name"></span>
            <div class="user-dropdown">
              <button onclick="logout()" class="dropdown-item">é€€å‡ºç™»å½•</button>
            </div>
          </div>
        </div>
      </div>

      <a href="cover-editor.html" class="header-btn view-all-btn">åˆ¶ä½œå°é¢</a>
      <a href="weekly-cards.html" class="header-btn view-all-btn" style="right: 115px;">æŸ¥çœ‹æ¯å‘¨ä¼šè®®å¡ç‰‡</a>
      <a href="cards.html" class="header-btn view-all-btn" style="right: 270px;">æŸ¥çœ‹å…¨éƒ¨æäº¤çš„å¡ç‰‡</a>
    </div>
  </header>


  <div class="container">
    <!-- Main Content -->
    <div class="main-content">
      <div class="form">
        <!-- ç¬¬ä¸€è¡Œï¼šæ ‡é¢˜ -->
        <div class="form-row">
          <div class="form-group" style="flex: 0 0 120px;">
            <label for="creator">åˆ›ä½œè€…</label>
            <input id="creator" placeholder="åŒ¿å" oninput="updateCardPreview()">
          </div>
          <div class="form-group" style="flex: 1;">
            <label for="title">æ ‡é¢˜</label>
            <input id="title" placeholder="è¿™ä¸€åˆ»ï¼Œæˆ‘æƒ³è¯´..." oninput="updateCardPreview()">
          </div>
        </div>

        <!-- ç¬¬äºŒè¡Œï¼šè§¦åŠ¨ä½ çš„è§‚ç‚¹ -->
        <div class="form-group">
          <label for="quote">è§¦åŠ¨ä½ çš„è§‚ç‚¹<small style="color: #888; font-size: 9px;">æŒ‰å›è½¦â†©ï¸æ¢è¡Œ</small></label>
          <textarea id="quote" oninput="updateCardPreview()" placeholder="å†™ä¸‹è®©ä½ è§¦åŠ¨çš„ä¸€å¥è¯ã€ä¸€æ®µå¯¹è¯ã€æˆ–ä¸€ä¸ªç‰‡æ®µ..."></textarea>
        </div>

        <!-- ç¬¬ä¸‰è¡Œï¼šä½ çš„å¯å‘ -->
        <div class="form-group">
          <label for="detail">ä½ çš„å¯å‘<small style="color: #888; font-size: 9px;">æ”¯æŒ Markdown è¯­æ³•ï¼ŒæŒ‰å›è½¦â†©ï¸æ¢è¡Œ</small></label>
          <textarea id="detail" oninput="updateCardPreview()" style="min-height: 100px; resize: vertical;"
            placeholder="å†™ä¸‹ä½ çš„å¯å‘å’Œè¡ŒåŠ¨å§..."></textarea>
          <div id="imageGenerationStatus" style="margin-top: 5px; font-size: 12px; color: #666;"></div>
        </div>

        <!-- ç¬¬å››è¡Œï¼šé€‰æ‹©èƒŒæ™¯ -->
        <div class="form-group">
          <label for="choose-gradient">é€‰æ‹©èƒŒæ™¯</label>
          <div class="gradient-selector" id="gradient-selector">
            <div class="gradient-option selected" data-gradient="card-gradient-1" title="ğŸŒˆ å½©è™¹æ¢¦å¢ƒ"></div>
            <div class="gradient-option" data-gradient="card-gradient-2" title="ğŸŒ… æ—¥å‡ºæš–é˜³"></div>
            <div class="gradient-option" data-gradient="card-gradient-3" title="ğŸ’œ ç´«è‰²å¹»æƒ³"></div>
            <div class="gradient-option" data-gradient="card-gradient-4" title="ğŸŒŠ æµ·æ´‹è“è°ƒ"></div>
            <div class="gradient-option" data-gradient="card-gradient-5" title="ğŸ”¥ ç«ç„°æ©™é»„"></div>
            <div class="gradient-option" data-gradient="card-gradient-6" title="ğŸŒ¿ æ¸…æ–°ç»¿æ„"></div>
            <div class="gradient-option" data-gradient="card-gradient-7" title="â¤ï¸ çƒ­æƒ…çº¢æ©™"></div>
            <div class="gradient-option" data-gradient="card-gradient-8" title="â˜ï¸ å¤©ç©ºè“ç™½"></div>
            <div class="gradient-option" data-gradient="card-gradient-9" title="ğŸŒ«ï¸ é›¾éœ­ç°è“"></div>
            <div class="gradient-option" data-gradient="card-gradient-10" title="ğŸ¯ èœ‚èœœæš–é»„"></div>
            <div class="gradient-option" data-gradient="card-gradient-11" title="ğŸŒ± è–„è·æ¸…ç»¿"></div>
            <div class="gradient-option" data-gradient="card-gradient-12" title="ğŸŒ¸ æ·¡é›…ç´«ç²‰"></div>
            <div class="gradient-option" data-gradient="card-gradient-13" title="ğŸŒ¾ éº¦ç”°é‡‘é»„"></div>
            <div class="gradient-option" data-gradient="card-gradient-14" title="ğŸŒ™ æœˆå…‰é“¶ç°"></div>
          </div>
        </div>

        <!-- æœ€åä¸€è¡Œï¼šè‡ªå®šä¹‰æ’å›¾ã€æ‰¾å›¾æŒ‰é’®ã€é€‰æ‹©å­—ä½“ -->
        <div class="form-row" style="margin-bottom: -36px;">
          <div class="form-group">
            <label for="bgUpload">è‡ªå®šä¹‰æ’å›¾</label>
            <div class="file-upload-wrapper">
              <button type="button" id="uploadBtn" class="upload-btn">ğŸ“· é€‰æ‹©æœ¬åœ°å›¾ç‰‡</button><br>
              <small id="fileStatus" style="color: #888; font-size: 7px; margin-left: 10px;"></small>
              <input type="file" id="bgUpload" accept="image/*" style="display: none;">
            </div>
          </div>
          <label for="bgUpload">æˆ–è€…</label>
          <div class="form-group">
            <label>&nbsp;</label>
            <button type="button" id="searchImagesBtn" class="upload-btn" style="min-width: 120px; padding: 8px 12px;">
              æ ¹æ®å¯å‘å†…å®¹æ‰¾å›¾ğŸ”
            </button>
          </div>
          <div class="form-group">
            <label for="choose-font">é€‰æ‹©å­—ä½“</label>
            <select id="choose-font" onchange="updateCardPreview()">
              <option value="'PingFang SC', sans-serif">è‹¹æ–¹</option>
              <option value="'Noto Sans SC', sans-serif">æ€æºé»‘ä½“</option>
              <option value="'Smiley Sans', sans-serif">å¾—æ„é»‘</option>
              <option value="'Ma Shan Zheng', cursive">é©¬å–„æ”¿æ¯›ç¬”ä½“</option>
              <option value="'LXGW WenKai', serif">éœé¹œæ–‡æ¥·</option>
              <option value="'Alibaba PuHuiTi', sans-serif">é˜¿é‡Œæ±‰ä»ªæ™ºèƒ½é»‘ä½“</option>
              <option value="'Noto Serif SC', serif">æ€æºå®‹ä½“</option>
              <option value="'KaiTi', serif">æ¥·ä½“</option>
            </select>
          </div>
        </div>

        <!-- è‡ªåŠ¨å›¾ç‰‡çŠ¶æ€æ˜¾ç¤º - éšè—æˆ–ç§»åˆ°ä¸æ˜æ˜¾ä½ç½® -->
        <div class="form-group" style="display: none;">
          <div id="autoImageStatus"
            style="font-size: 10px; color: #999; text-align: center; opacity: 0.7;">æ­£åœ¨æ ¹æ®èƒŒæ™¯é¢œè‰²è‡ªåŠ¨åŒ¹é…å›¾ç‰‡...
          </div>
        </div>

        <!-- æœç´¢å›¾ç‰‡çŠ¶æ€å’Œç»“æœæ˜¾ç¤ºåŒº -->
        <!-- <div class="form-group"> -->
          <div id="searchImagesStatus" style="margin-top: -5px; font-size: 12px; color: #666;"></div>
          <!-- æœç´¢ç»“æœå›¾ç‰‡å±•ç¤ºåŒº -->
          <div id="searchImagesResults" style="display: none; margin-top: -2px;">
            <h5 style="margin-bottom: 10px; font-size: 14px;">æœç´¢ç»“æœï¼š<span id="searchQuery"></span></h5>
            <div id="imageResults" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
          </div>
        <!-- </div> -->

        <div class="buttons">
          <button onclick="submitCard()" class="primary-btn">æäº¤åˆ°å±•ç¤ºåŒº</button>
          <button onclick="downloadCardImage()">ä¸‹è½½å¡ç‰‡</button>
          <!-- <button onclick="shareToWechat()" class="upload-btn">ğŸ“± åˆ†äº«åˆ°å¾®ä¿¡</button> -->
        </div>
      </div>

      <div id="preview" class="animate__animated animate__fadeIn">
        <!-- å¡ç‰‡å†…å®¹å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
      </div>
    </div>

    <!-- Latest Submitted Cards Section -->
    <div class="latest-cards-section">
      <h2>å±•ç¤ºåŒº</h2>
      <div class="carousel-container">
        <div class="swiper" id="latest-cards-swiper">
          <div class="swiper-wrapper" id="latest-cards">
            <!-- Cards will be loaded here -->
          </div>
          <div class="swiper-pagination"></div>
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
        </div>
      </div>
      <div class="view-all-button-container">
        <a href="cards.html" class="view-all-button">æµè§ˆæ›´å¤šçµæ„Ÿ</a>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="page-footer">
    <p>å¯å‘æ˜Ÿçƒ âœ¨ Inspiration Planet Â© 2025</p>
  </footer>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

  <!-- Main script using ES modules -->
  <script type="module">
    // Import functions from cardUtils.js
    import {
      renderEditorCard,
      renderCarouselCard,
      downloadCard,
      uploadCard,
      fetchCards,
      onUploadBg,
      bindCustomFileUpload,
      getRandomItem,
      sanitizeAndValidateCard,
      processLongUrls
    } from './scripts/cardUtils.js';

    // Global variables
    window.customImage = "";
    window.currentGradientClass = "";
    window.selectedSearchImage = null;
    window.isLoadingAutoImage = false; // è·Ÿè¸ªè‡ªåŠ¨å›¾ç‰‡åŠ è½½çŠ¶æ€

    // å›¾ç‰‡ç¼“å­˜å¯¹è±¡
    const imageCache = {};

    let swiper;

    // æ¸å˜æ ·å¼æ•°ç»„
    // å¯¼å…¥å…±äº«çš„æ¸å˜é…ç½®
    import { gradientClasses, gradientFontColors, getFontColorForGradient } from './scripts/gradientConfig.js';



    // éšæœºé€‰æ‹©æ¸å˜èƒŒæ™¯
    function randomizeGradient() {
      const randomIndex = Math.floor(Math.random() * gradientClasses.length);
      window.currentGradientClass = gradientClasses[randomIndex];
      return window.currentGradientClass;
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function () {
      // åˆå§‹åŒ–éšæœºæ¸å˜
      randomizeGradient();

      // åˆå§‹åŒ–æ¸å˜é€‰æ‹©å™¨
      initGradientSelector();

      // æ ¹æ®åˆå§‹èƒŒæ™¯é¢œè‰²è‡ªåŠ¨æœç´¢å›¾ç‰‡
      autoSearchImagesByGradient(window.currentGradientClass);

      // å·²ç§»é™¤å†…ç½®å›¾ç‰‡é€‰æ‹©åŠŸèƒ½
      // loadImages(() => {
      //   // Initial card render after images are loaded
      //   updateCardPreview();
      // });

      // Initial card render
      updateCardPreview();

      // Setup file upload
      setupFileUpload();

      // Load latest cards
      loadLatestCardsCarousel();

      // è‡ªåŠ¨èšç„¦åˆ°æ ‡é¢˜è¾“å…¥æ¡†
      setTimeout(() => {
        const titleInput = document.getElementById('title');
        if (titleInput) {
          titleInput.focus();
        }
      }, 500);

      // æ£€æŸ¥URLå‚æ•°ä¸­çš„ç™»å½•ä¿¡æ¯ï¼ˆä»ä¸»åŸŸåç™»å½•åçš„å›è°ƒï¼‰
      checkLoginCallback();

      // åˆå§‹åŒ–è®¤è¯UI
      updateAuthUI();

      // ç›‘å¬storageå˜åŒ–ï¼ˆç”¨äºå¤šæ ‡ç­¾é¡µåŒæ­¥ï¼‰
      window.addEventListener('storage', function (e) {
        if (e.key === 'authToken' || e.key === 'user') {
          updateAuthUI();
        }
      });
    });

    // åˆå§‹åŒ–æ¸å˜é€‰æ‹©å™¨
    function initGradientSelector() {
      const gradientOptions = document.querySelectorAll('.gradient-option');

      // è®¾ç½®é»˜è®¤é€‰ä¸­çŠ¶æ€
      gradientOptions.forEach(option => {
        option.classList.remove('selected');
        if (option.dataset.gradient === window.currentGradientClass) {
          option.classList.add('selected');
        }
      });

      // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
      gradientOptions.forEach(option => {
        option.addEventListener('click', function () {
          // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
          gradientOptions.forEach(opt => opt.classList.remove('selected'));
          // æ·»åŠ å½“å‰é€‰ä¸­çŠ¶æ€
          this.classList.add('selected');
          // æ›´æ–°å½“å‰æ¸å˜ç±»
          window.currentGradientClass = this.dataset.gradient;
          // æ ¹æ®æ–°é€‰æ‹©çš„èƒŒæ™¯é¢œè‰²è‡ªåŠ¨æœç´¢å›¾ç‰‡
          autoSearchImagesByGradient(window.currentGradientClass);
          // æ›´æ–°å¡ç‰‡é¢„è§ˆ
          updateCardPreview();
        });
      });
    }

    // Function to handle gradient selection (ä¿æŒå‘åå…¼å®¹)
    window.updateGradientSelection = function () {
      // è¿™ä¸ªå‡½æ•°ç°åœ¨ä¸»è¦ç”¨äºå‘åå…¼å®¹ï¼Œå®é™…åŠŸèƒ½ç”±initGradientSelectorå¤„ç†
      updateCardPreview();
    };

    // Function to handle image selection - å·²ç§»é™¤å†…ç½®å›¾ç‰‡é€‰æ‹©åŠŸèƒ½
    // window.onSelectImage = function () {
    //   customImage = "";
    //   // æ¸…é™¤æœç´¢é€‰ä¸­çš„å›¾ç‰‡
    //   window.selectedSearchImage = null;
    //   document.getElementById("fileStatus").innerHTML = "";
    //   updateCardPreview();
    // };

    // Function to submit a card
    window.submitCard = function () {
      // ç¡®ä¿ä½¿ç”¨å½“å‰é€‰æ‹©çš„æ¸å˜èƒŒæ™¯ï¼ˆä»é€‰ä¸­çš„å°æ–¹å—è·å–ï¼‰
      const selectedOption = document.querySelector('.gradient-option.selected');
      if (selectedOption) {
        window.currentGradientClass = selectedOption.dataset.gradient;
      }

      uploadCard({
        gradientClass: window.currentGradientClass,
        font: document.getElementById("choose-font").value,
        title: document.getElementById('title').value,
        quote: document.getElementById('quote').value,
        imagePath: '',
        detail: document.getElementById('detail').value,
        creator: document.getElementById('creator').value,
        upload: customImage,
        searchImageSelected: document.getElementById('quote-image-preview-card').src || '',
      }).then((result) => {
        if (result) {
          // Refresh latest cards carousel
          loadLatestCardsCarousel();
        }
      });
    };

    window.updateCardPreview = function (uploadImg) {
      // If uploadImg is provided, update the customImage variable
      if (uploadImg) {
        customImage = uploadImg;
      }

      // è·å–è¯¦æƒ…å†…å®¹å¹¶è½¬æ¢Markdownä¸ºHTML
      const detailText = document.getElementById('detail').value || 'è¯·å¡«å†™ä½ çš„å¯å‘å’Œè¡ŒåŠ¨';

      // é…ç½®markedï¼Œå¯ç”¨æ¢è¡Œé€‰é¡¹
      marked.setOptions({
        breaks: true  // å°†å•ä¸ªæ¢è¡Œç¬¦è§£æä¸º<br>
      });

      // ä½¿ç”¨marked.jsè§£æMarkdown
      const parsedDetail = detailText ? marked.parse(detailText) : '';

      const options = {
        title: document.getElementById('title').value || 'è¿™ä¸€åˆ»ï¼Œæˆ‘æƒ³è¯´...',
        quote: document.getElementById('quote').value || 'è¯·å†™ä¸‹è§¦åŠ¨åˆ°ä½ çš„è§‚ç‚¹',
        detail: parsedDetail, // ä½¿ç”¨è§£æåçš„HTML
        imagePath: '',
        creator: document.getElementById('creator').value || 'åŒ¿å',
        font: document.getElementById('choose-font').value || `'Noto Sans SC', sans-serif`,
        gradientClass: window.currentGradientClass,
        customImage: customImage,
        created: new Date().toISOString(), // æ·»åŠ å½“å‰æ—¶é—´
        isMarkdown: true // æ ‡è®°ä½¿ç”¨äº†Markdown
      };

      // ä¼˜å…ˆçº§ï¼šæœç´¢é€‰ä¸­çš„å›¾ç‰‡ > è‡ªå®šä¹‰ä¸Šä¼ çš„å›¾ç‰‡ > åŠ è½½çŠ¶æ€æ˜¾ç¤º
      // æ£€æŸ¥æ˜¯å¦æœ‰çœŸæ­£é€‰æ‹©çš„æœç´¢ç»“æœå›¾ç‰‡ï¼ˆé€šè¿‡ç‰¹å®šçš„æ ‡è¯†æ¥åˆ¤æ–­ï¼‰
      const searchSelectedImage = window.selectedSearchImage || '';
      let finalImage = searchSelectedImage || customImage;

      // å¦‚æœæ­£åœ¨åŠ è½½è‡ªåŠ¨å›¾ç‰‡ä¸”æ²¡æœ‰é€‰ä¸­çš„å›¾ç‰‡ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€è€Œä¸æ˜¯å†…ç½®å›¾ç‰‡
      if (window.isLoadingAutoImage && !finalImage) {
        finalImage = null; // ä¸æ˜¾ç¤ºä»»ä½•å›¾ç‰‡ï¼Œç¨åä¼šæ·»åŠ åŠ è½½æç¤º
      } else if (!finalImage) {
        finalImage = ''; // æ²¡æœ‰å†…ç½®å›¾ç‰‡é€‰æ‹©åŠŸèƒ½
      }
      // æ ¼å¼åŒ–å½“å‰æ—¶é—´
      const now = new Date();
      const pad = (n) => n.toString().padStart(2, '0');
      const currentTime = `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}`;

      // è·å–å½“å‰æ¸å˜å¯¹åº”çš„å­—ä½“é¢œè‰²
      const fontColor = getFontColorForGradient(window.currentGradientClass);
      const quoteBoxBg = 'rgba(255, 255, 255, 0.9)';
      const cardHTML = `
        <div class="card ${window.currentGradientClass}" style="
              font-family: ${options.font};
              color: ${fontColor};
            ">
           <div class="card-body">
            <div class="title">${options.title}</div>
            <div class="quote-box" style="
              background-color: ${quoteBoxBg}; 
              color: ${fontColor};
            ">${options.quote}</div>
            ${finalImage ? `<img id="quote-image-preview-card" src="${finalImage}" alt="Card Image" crossorigin="anonymous" />` : (window.isLoadingAutoImage ? `<div class="image-loading-placeholder" style="
              width: 100%;
              height: 200px;
              background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
              background-size: 20px 20px;
              background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
              border-radius: 12px;
              display: flex;
              align-items: center;
              justify-content: center;
              color: #666;
              font-size: 14px;
              animation: shimmer 2s infinite;
            ">æ­£åœ¨ä¸ºæ‚¨åŒ¹é…å›¾ç‰‡...</div>` : '')}
            <div class="detail-text">${processLongUrls(options.detail)}</div>
          </div>
          <div class="card-footer">
            <div class="footer" style="color: ${fontColor}">â€”â€”ä½œè€…ï¼š${options.creator} Â· ${currentTime}</div>
          </div>
        </div>
      `;

      // Clear the preview container and append the new card
      const previewContainer = document.getElementById('preview');
      previewContainer.innerHTML = cardHTML;
    };

    // Function to download the current card
    window.downloadCardImage = function () {
      downloadCard(".card", "inspiration-card-");
    };

    // Setup file upload functionality
    function setupFileUpload() {
      const bgUpload = document.getElementById('bgUpload');
      const uploadBtn = document.getElementById('uploadBtn');
      const fileStatus = document.getElementById('fileStatus');

      if (!bgUpload || !uploadBtn || !fileStatus) {
        console.warn("ä¸Šä¼ åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥ï¼šå…ƒç´ æœªæ‰¾åˆ°");
        return;
      }

      // ç›´æ¥ç»‘å®šä¸Šä¼ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      uploadBtn.addEventListener('click', () => {
        bgUpload.click();
      });

      // ç»‘å®šæ–‡ä»¶é€‰æ‹©äº‹ä»¶
      bgUpload.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          customImage = e.target.result;
          // æ¸…é™¤æœç´¢é€‰ä¸­çš„å›¾ç‰‡ï¼Œé¿å…å†²çª
          window.selectedSearchImage = null;
          fileStatus.textContent = 'å·²ä¸Šä¼ ï¼š' + file.name;
          updateCardPreview(customImage); // ç¡®ä¿ä¼ é€’å›¾ç‰‡æ•°æ®
          event.target.value = ''; // æ¸…ç©ºå€¼ä»¥æ”¯æŒé‡å¤ä¸Šä¼ 
        };
        reader.readAsDataURL(file);
      });

    }

    // Load and render latest cards to carousel
    async function loadLatestCardsCarousel() {
      const container = document.getElementById('latest-cards');
      if (!container) return;

      // Show loading indicator
      container.innerHTML = '<div class="swiper-slide"><div class="loading-indicator">åŠ è½½ä¸­...</div></div>';

      try {
        const cards = await fetchCards();

        if (!cards || cards.length === 0) {
          container.innerHTML = '<div class="swiper-slide"><div class="loading-indicator">æš‚æ— å¡ç‰‡æ•°æ®</div></div>';
          return;
        }

        // Clear loading indicator
        container.innerHTML = '';

        // Filter valid cards and limit to 20
        const validCards = cards.filter(card => card && card.Title && card.Quote).map(card => sanitizeAndValidateCard(card, ['Font', 'Title', 'Quote', 'Detail', 'ImagePath', 'Creator']))
          .filter(result => result.isValid)
          .map(result => result.sanitizedCard);
        const recentCards = validCards.slice(0, 20);

        // Render each card
        recentCards.forEach((card, index) => {
          const cardElement = renderCarouselCard(card, index);
          cardElement.style.cursor = 'pointer';
          cardElement.addEventListener('click', () => {
            window.location.href = `card-detail.html?id=${card.id}`;
          });
          container.appendChild(cardElement);
        });

        // Initialize or update Swiper
        initOrUpdateSwiper();
      } catch (error) {
        console.error('åŠ è½½æœ€æ–°å¡ç‰‡å¤±è´¥:', error);
        container.innerHTML = '<div class="swiper-slide"><div class="loading-indicator">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åå†è¯•</div></div>';
      }
    }

    // Initialize or update Swiper
    function initOrUpdateSwiper() {
      if (swiper) {
        swiper.update();
      } else {
        swiper = new Swiper('#latest-cards-swiper', {
          slidesPerView: 1,
          spaceBetween: 30,
          loop: true,
          centeredSlides: true,
          autoplay: {
            delay: 5 * 60 * 1000,
            disableOnInteraction: true,
          },
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
          breakpoints: {
            640: {
              slidesPerView: 1,
            },
            768: {
              slidesPerView: 2,
            },
            1024: {
              slidesPerView: 3,
            },
          }
        });
      }
    }
    // æ ¹æ®æ¸å˜èƒŒæ™¯é¢œè‰²è‡ªåŠ¨æœç´¢å›¾ç‰‡
    async function autoSearchImagesByGradient(gradientClass) {
      const statusDiv = document.getElementById('autoImageStatus');
      const resultsDiv = document.getElementById('autoImageResults');
      const imageGridDiv = document.getElementById('autoImageGrid');
      
      // å¦‚æœæ˜¾ç¤ºå…ƒç´ ä¸å­˜åœ¨ï¼Œä»ç„¶æ‰§è¡Œæœç´¢ä½†ä¸æ˜¾ç¤ºç•Œé¢

      // å®šä¹‰æ¸å˜å¯¹åº”çš„æœç´¢å…³é”®è¯
      const gradientSearchTerms = {
        'card-gradient-1': 'rainbow colorful abstract art',
        'card-gradient-2': 'sunrise warm orange yellow nature',
        'card-gradient-3': 'purple fantasy magical violet',
        'card-gradient-4': 'ocean blue water sea waves',
        'card-gradient-5': 'fire flame orange red energy',
        'card-gradient-6': 'green nature forest fresh leaves',
        'card-gradient-7': 'red orange passion warm sunset',
        'card-gradient-8': 'sky blue white clouds peaceful',
        'card-gradient-9': 'grey mist fog minimal calm',
        'card-gradient-10': 'honey yellow warm golden light',
        'card-gradient-11': 'mint green fresh nature spring',
        'card-gradient-12': 'purple pink soft pastel flowers',
        'card-gradient-13': 'golden wheat field warm autumn',
        'card-gradient-14': 'silver grey moonlight minimal'
      };

      const searchTerm = gradientSearchTerms[gradientClass] || 'abstract colorful';

      try {
        // æ£€æŸ¥ç¼“å­˜
        if (imageCache[gradientClass] && imageCache[gradientClass].length > 0) {
          // ä»ç¼“å­˜ä¸­éšæœºé€‰æ‹©ä¸€å¼ å›¾ç‰‡
          const cachedImages = imageCache[gradientClass];
          const randomIndex = Math.floor(Math.random() * cachedImages.length);
          const selectedImage = cachedImages[randomIndex];

          // è®¾ç½®é€‰ä¸­çš„å›¾ç‰‡
          window.selectedSearchImage = selectedImage.url;
          window.customImage = null;
          window.isLoadingAutoImage = false;

          // æ˜¾ç¤ºç¼“å­˜çš„å›¾ç‰‡
          displayImages(cachedImages, randomIndex, statusDiv, resultsDiv, imageGridDiv);

          // æ›´æ–°çŠ¶æ€
          statusDiv.textContent = 'å·²ä»ç¼“å­˜åŠ è½½å›¾ç‰‡';

          // æ›´æ–°å¡ç‰‡é¢„è§ˆ
          updateCardPreview();
          return;
        }

        // è®¾ç½®åŠ è½½çŠ¶æ€
        window.isLoadingAutoImage = true;
        window.selectedSearchImage = null;
        window.customImage = null;

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤ºå’Œå¡ç‰‡é¢„è§ˆ
        if (statusDiv) statusDiv.textContent = 'æ­£åœ¨æ ¹æ®èƒŒæ™¯é¢œè‰²è‡ªåŠ¨åŒ¹é…å›¾ç‰‡...';
        if (resultsDiv) resultsDiv.style.display = 'none';
        updateCardPreview(); // ç«‹å³æ›´æ–°é¢„è§ˆæ˜¾ç¤ºåŠ è½½çŠ¶æ€

        // è°ƒç”¨æœç´¢API
        const response = await fetch('/.netlify/functions/searchImage', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            text: searchTerm,
            orientation: 'landscape'
          }),
        });

        const data = await response.json();

        if (response.ok && data.images && data.images.length > 0) {
          // ç¼“å­˜å›¾ç‰‡æ•°æ®
          imageCache[gradientClass] = data.images;

          // æ¸…é™¤åŠ è½½çŠ¶æ€å¹¶éšæœºé€‰æ‹©ä¸€å¼ å›¾ç‰‡
          window.isLoadingAutoImage = false;
          const randomIndex = Math.floor(Math.random() * data.images.length);
          const selectedImage = data.images[randomIndex];
          window.selectedSearchImage = selectedImage.url;
          window.customImage = null; // æ¸…é™¤è‡ªå®šä¹‰ä¸Šä¼ çš„å›¾ç‰‡

          // æ˜¾ç¤ºæ‰€æœ‰å›¾ç‰‡ä¾›ç”¨æˆ·é€‰æ‹©ï¼ˆå¦‚æœæ˜¾ç¤ºå…ƒç´ å­˜åœ¨ï¼‰
          if (statusDiv && resultsDiv && imageGridDiv) {
            displayImages(data.images, randomIndex, statusDiv, resultsDiv, imageGridDiv);
          }

          // æ›´æ–°çŠ¶æ€
          if (statusDiv) statusDiv.textContent = '';

          // æ›´æ–°å¡ç‰‡é¢„è§ˆ
          updateCardPreview();
        } else {
          // æ¸…é™¤åŠ è½½çŠ¶æ€
          window.isLoadingAutoImage = false;
          if (statusDiv) statusDiv.textContent = 'æœªæ‰¾åˆ°åŒ¹é…çš„å›¾ç‰‡';
          window.selectedSearchImage = null;
          window.customImage = null;
          updateCardPreview();
        }
      } catch (error) {
        // æ¸…é™¤åŠ è½½çŠ¶æ€
        window.isLoadingAutoImage = false;
        console.error('è‡ªåŠ¨æœç´¢å›¾ç‰‡å¤±è´¥:', error);
        if (statusDiv) statusDiv.textContent = 'è‡ªåŠ¨æœç´¢å›¾ç‰‡å¤±è´¥ï¼Œè¯·ç¨åå†è¯•';
        window.selectedSearchImage = null;
        window.customImage = null;
        updateCardPreview();
      }
    }

    // æ˜¾ç¤ºå›¾ç‰‡çš„è¾…åŠ©å‡½æ•°
    function displayImages(images, selectedIndex, statusDiv, resultsDiv, imageGridDiv) {
      // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
      imageGridDiv.innerHTML = '';

      images.forEach((image, index) => {
        const imgContainer = document.createElement('div');
        imgContainer.style.width = 'calc(33.33% - 10px)';
        imgContainer.style.position = 'relative';
        imgContainer.style.cursor = 'pointer';
        imgContainer.style.borderRadius = '8px';
        imgContainer.style.overflow = 'hidden';
        imgContainer.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';

        // é€‰ä¸­çš„å›¾ç‰‡é«˜äº®æ˜¾ç¤º
        if (index === selectedIndex) {
          imgContainer.style.border = '3px solid #4a6fa5';
        }

        const img = document.createElement('img');
        img.src = image.thumb;
        img.alt = image.title;
        img.style.width = '100%';
        img.style.height = '100px';
        img.style.objectFit = 'cover';

        const overlay = document.createElement('div');
        overlay.style.position = 'absolute';
        overlay.style.bottom = '0';
        overlay.style.left = '0';
        overlay.style.right = '0';
        overlay.style.backgroundColor = 'rgba(0,0,0,0.6)';
        overlay.style.color = 'white';
        overlay.style.padding = '4px';
        overlay.style.fontSize = '10px';
        overlay.textContent = image.description;

        imgContainer.appendChild(img);
        imgContainer.appendChild(overlay);

        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        imgContainer.addEventListener('click', () => {
          window.selectedSearchImage = image.url;
          window.customImage = null;

          // æ›´æ–°é€‰ä¸­çŠ¶æ€
          document.querySelectorAll('#autoImageGrid > div').forEach(div => {
            div.style.border = 'none';
          });
          imgContainer.style.border = '3px solid #4a6fa5';

          // æ›´æ–°å¡ç‰‡é¢„è§ˆ
          updateCardPreview();
        });

        imageGridDiv.appendChild(imgContainer);
      });

      // æ˜¾ç¤ºç»“æœ
      resultsDiv.style.display = 'block';
    }

    // Function to search for images based on inspiration content
    async function searchImagesFromDetail() {
      // Get content from all three fields
      const titleText = document.getElementById('title').value || '';
      const quoteText = document.getElementById('quote').value || '';
      const detailText = document.getElementById('detail').value || '';

      // Check if at least one field has content
      if (!titleText && !quoteText && !detailText) {
        alert('è¯·å…ˆè¾“å…¥æ ‡é¢˜ã€å¼•ç”¨æˆ–å¯å‘å†…å®¹');
        return;
      }

      const searchBtn = document.getElementById('searchImagesBtn');
      const statusDiv = document.getElementById('searchImagesStatus');
      const resultsDiv = document.getElementById('searchImagesResults');
      const querySpan = document.getElementById('searchQuery');
      const imageResultsDiv = document.getElementById('imageResults');

      try {
        // Update UI to show loading state
        searchBtn.disabled = true;
        statusDiv.textContent = 'æ­£åœ¨æœç´¢ç›¸å…³å›¾ç‰‡ï¼Œè¯·ç¨å€™...';
        resultsDiv.style.display = 'none';

        // Combine all three fields for searching
        const combinedText = [titleText, quoteText, detailText].filter(text => text.trim()).join(' ');

        // Call the Netlify function
        const response = await fetch('/.netlify/functions/searchImage', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            text: combinedText,
            orientation: 'landscape'
          }),
        });

        const data = await response.json();

        if (response.ok) {
          // Display the search query
          querySpan.textContent = data.query;

          // Clear previous results
          imageResultsDiv.innerHTML = '';

          // Display the images
          if (data.images && data.images.length > 0) {
            data.images.forEach(image => {
              const imgContainer = document.createElement('div');
              imgContainer.style.width = 'calc(33.33% - 10px)';
              imgContainer.style.position = 'relative';
              imgContainer.style.cursor = 'pointer';
              imgContainer.style.borderRadius = '8px';
              imgContainer.style.overflow = 'hidden';
              imgContainer.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';

              const img = document.createElement('img');
              img.src = image.thumb;
              img.alt = image.title;
              img.style.width = '100%';
              img.style.height = '100px';
              img.style.objectFit = 'cover';

              const overlay = document.createElement('div');
              overlay.style.position = 'absolute';
              overlay.style.bottom = '0';
              overlay.style.left = '0';
              overlay.style.right = '0';
              overlay.style.backgroundColor = 'rgba(0,0,0,0.6)';
              overlay.style.color = 'white';
              overlay.style.padding = '4px';
              overlay.style.fontSize = '10px';
              overlay.textContent = image.description;

              imgContainer.appendChild(img);
              imgContainer.appendChild(overlay);

              // Add click event to select this image
              imgContainer.addEventListener('click', () => {
                // è®¾ç½®é€‰ä¸­çš„æœç´¢å›¾ç‰‡
                window.selectedSearchImage = image.url;
                // æ¸…é™¤è‡ªå®šä¹‰ä¸Šä¼ çš„å›¾ç‰‡ï¼Œé¿å…å†²çª
                customImage = null;
                // æ›´æ–°æ–‡ä»¶çŠ¶æ€æ˜¾ç¤º
                const fileStatus = document.getElementById('fileStatus');
                if (fileStatus) {
                  fileStatus.textContent = 'å·²é€‰æ‹©æœç´¢ç»“æœå›¾ç‰‡';
                }
                // Update the card preview
                updateCardPreview();
                // Add a highlight to the selected image
                document.querySelectorAll('#imageResults > div').forEach(div => {
                  div.style.border = 'none';
                });
                imgContainer.style.border = '3px solid #4a6fa5';
              });

              imageResultsDiv.appendChild(imgContainer);
            });

            // Show the results
            resultsDiv.style.display = 'block';
            statusDiv.textContent = ''; // Clear status message
          } else {
            statusDiv.textContent = 'æœªæ‰¾åˆ°ç›¸å…³å›¾ç‰‡ï¼Œè¯·å°è¯•ä¿®æ”¹å¯å‘å†…å®¹ã€‚';
          }
        } else {
          throw new Error(data.error || 'æœç´¢å›¾ç‰‡å¤±è´¥');
        }
      } catch (error) {
        console.error('Error searching images:', error);
        statusDiv.textContent = `æœç´¢å¤±è´¥: ${error.message}`;
      } finally {
        searchBtn.disabled = false;
      }
    }

    // Add event listener for the search images button
    document.getElementById('searchImagesBtn').addEventListener('click', searchImagesFromDetail);

    // æ£€æŸ¥ç™»å½•å›è°ƒ
    function checkLoginCallback() {
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      const userInfo = urlParams.get('user');
      
      if (token && userInfo) {
        try {
          // è§£ç ç”¨æˆ·ä¿¡æ¯
          const user = JSON.parse(decodeURIComponent(userInfo));
          
          // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
          localStorage.setItem('authToken', token);
          localStorage.setItem('user', JSON.stringify(user));
          
          // æ¸…é™¤URLå‚æ•°
          const newUrl = window.location.pathname;
          window.history.replaceState({}, document.title, newUrl);
          
          // æ›´æ–°UI
          updateAuthUI();
          
          console.log('ç™»å½•æˆåŠŸï¼Œæ¬¢è¿å›æ¥ï¼');
        } catch (error) {
          console.error('å¤„ç†ç™»å½•å›è°ƒå¤±è´¥:', error);
        }
      }
    }

    // Authentication functions
    async function checkAuthStatus() {
      // é¦–å…ˆæ£€æŸ¥æœ¬åœ°å­˜å‚¨
      const token = localStorage.getItem('authToken');
      const user = localStorage.getItem('user');

      if (token && user) {
        try {
          return JSON.parse(user);
        } catch (e) {
          console.error('è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', e);
        }
      }

      // å¦‚æœæœ¬åœ°æ²¡æœ‰ç™»å½•ä¿¡æ¯ï¼Œå°è¯•ä»ä¸»åŸŸåæ£€æŸ¥ç™»å½•çŠ¶æ€
      try {
        const response = await fetch('https://bysunling.com/api/auth/status', {
          method: 'GET',
          credentials: 'include', // åŒ…å«cookies
          headers: {
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          const data = await response.json();
          if (data.user && data.token) {
            // åŒæ­¥ç™»å½•çŠ¶æ€åˆ°æœ¬åœ°
            localStorage.setItem('authToken', data.token);
            localStorage.setItem('user', JSON.stringify(data.user));
            return data.user;
          }
        }
      } catch (error) {
        console.log('æ— æ³•ä»ä¸»åŸŸåè·å–ç™»å½•çŠ¶æ€:', error.message);
      }

      return null;
    }

    window.logout = async function () {
      // æ¸…é™¤æœ¬åœ°ç™»å½•çŠ¶æ€
      localStorage.removeItem('authToken');
      localStorage.removeItem('user');
      
      // å°è¯•ä»ä¸»åŸŸåç™»å‡º
      try {
        await fetch('https://bysunling.com/api/auth/logout', {
          method: 'POST',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          }
        });
      } catch (error) {
        console.log('ä¸»åŸŸåç™»å‡ºå¤±è´¥:', error.message);
      }
      
      updateAuthUI();
      // å¯é€‰ï¼šåˆ·æ–°é¡µé¢æˆ–é‡å®šå‘
      window.location.reload();
    };

    async function updateAuthUI() {
      const user = await checkAuthStatus();
      const loginButtons = document.getElementById('login-buttons');
      const userProfile = document.getElementById('user-profile');

      if (user) {
        // å·²ç™»å½•çŠ¶æ€
        if (loginButtons) loginButtons.style.display = 'none';
        if (userProfile) userProfile.style.display = 'block';

        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        const userAvatar = document.getElementById('user-avatar');
        const userName = document.getElementById('user-name');

        if (userAvatar && userName) {
          // è®¾ç½®å¤´åƒï¼ˆå¦‚æœç”¨æˆ·æœ‰å¤´åƒURLï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å¤´åƒï¼‰
          if (user.avatar_url) {
            userAvatar.src = user.avatar_url;
          } else {
            // ä½¿ç”¨ç”¨æˆ·åé¦–å­—æ¯ç”Ÿæˆå¤´åƒ
            userAvatar.src = generateAvatarUrl(user.email || user.username || 'ç”¨æˆ·');
          }

          // è®¾ç½®ç”¨æˆ·å
          userName.textContent = user.username || user.email || 'ç”¨æˆ·';
        }

        // è‡ªåŠ¨å¡«å……åˆ›ä½œè€…å­—æ®µ
        const creatorInput = document.getElementById('creator');
        if (creatorInput && !creatorInput.value) {
          creatorInput.value = user.name || user.username || user.email || '';
          // æ›´æ–°å¡ç‰‡é¢„è§ˆ
          updateCardPreview();
        }
      } else {
        // æœªç™»å½•çŠ¶æ€
        if (loginButtons) {
          loginButtons.style.display = 'flex';
        }
        if (userProfile) userProfile.style.display = 'none';
      }
    }

    // ç”Ÿæˆé»˜è®¤å¤´åƒURLï¼ˆä½¿ç”¨ç”¨æˆ·åé¦–å­—æ¯ï¼‰
    function generateAvatarUrl(name) {
      const firstChar = name.charAt(0).toUpperCase();
      const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
      const colorIndex = name.charCodeAt(0) % colors.length;
      const bgColor = colors[colorIndex];

      // åˆ›å»ºæœ¬åœ°SVGå¤´åƒä»¥é¿å…CORSé—®é¢˜
      const svg = `
        <svg width="64" height="64" xmlns="http://www.w3.org/2000/svg">
          <rect width="64" height="64" fill="${bgColor}"/>
          <text x="32" y="40" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="white">${firstChar}</text>
        </svg>
      `;

      // å°†SVGè½¬æ¢ä¸ºdata URL
      const svgBlob = new Blob([svg], { type: 'image/svg+xml' });
      return URL.createObjectURL(svgBlob);
    }

    // åˆ†äº«åŠŸèƒ½å·²ç§»è‡³ shareUtils.js æ¨¡å—
  </script>
</body>

</html>